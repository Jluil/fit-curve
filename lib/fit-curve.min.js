(function(y,v){if("function"===typeof define&&define.amd)define(["module"],v);else if("undefined"!==typeof exports)v(module);else{var w={exports:{}};v(w);y.fitCurve=w.exports}})(this,function(y){function v(a,h){if(!(a instanceof h))throw new TypeError("Cannot call a class as a function");}function w(c,h,b,d,k){var m,f,n,l,g,e,p,q;if(2===c.length)return d=a.vectorLen(a.subtract(c[0],c[1]))/3,m=[c[0],a.addArrays(c[0],a.mulItems(h,d)),a.addArrays(c[1],a.mulItems(b,d)),c[1]],[m];f=A(c);e=z(c,f,f,h,b,
k);m=e[0];l=e[1];e=e[2];if(l<d)return[m];if(l<d*d)for(n=f,g=l,p=e,q=0;20>q;q++){n=B(m,c,n);e=z(c,f,n,h,b,k);m=e[0];l=e[1];e=e[2];if(l<d)return[m];if(e===p&&(g=l/g,.9999<g&&1.0001>g))break;g=l;p=e}m=[];f=a.subtract(c[e-1],c[e+1]);0===f[0]&&0===f[1]&&(f=a.subtract(c[e-1],c[e]).reverse(),f[0]=-f[0]);f=a.normalize(f);l=a.mulItems(f,-1);m=m.concat(w(c.slice(0,e+1),h,f,d,k));return m=m.concat(w(c.slice(e),l,b,d,k))}function z(c,h,b,d,k,m){var f,n,l,g,e,p,q,t,r=c[0],u=c[c.length-1];f=[r,null,null,u];n=a.zeros_Xx2x2(b.length);
p=0;for(q=b.length;p<q;p++)t=b[p],g=1-t,l=n[p],l[0]=a.mulItems(d,3*t*g*g),l[1]=a.mulItems(k,3*g*t*t);g=[[0,0],[0,0]];e=[0,0];p=0;for(q=c.length;p<q;p++)t=b[p],l=n[p],g[0][0]+=a.dot(l[0],l[0]),g[0][1]+=a.dot(l[0],l[1]),g[1][0]+=a.dot(l[0],l[1]),g[1][1]+=a.dot(l[1],l[1]),t=a.subtract(c[p],x.q([r,r,u,u],t)),e[0]+=a.dot(l[0],t),e[1]+=a.dot(l[1],t);b=g[0][0]*g[1][1]-g[1][0]*g[0][1];n=g[0][0]*e[1]-g[1][0]*e[0];g=e[0]*g[1][1]-e[1]*g[0][1];g=0===b?0:g/b;e=0===b?0:n/b;n=a.vectorLen(a.subtract(r,u));b=1E-6*
n;g<b||e<b?(f[1]=a.addArrays(r,a.mulItems(d,n/3)),f[2]=a.addArrays(u,a.mulItems(k,n/3))):(f[1]=a.addArrays(r,a.mulItems(d,g)),f[2]=a.addArrays(u,a.mulItems(k,e)));d=0;k=c.length/2;g=C(f,10);r=0;for(u=c.length;r<u;r++){e=c[r];b=h[r];if(0>b)b=0;else if(1<b)b=1;else{n=void 0;for(q=1;10>=q;q++)if(b<=g[q]){p=(q-1)/10;l=q/10;n=g[q-1];q=g[q];n=(b-n)/(q-n)*(l-p)+p;break}b=n}e=a.subtract(x.q(f,b),e);e=e[0]*e[0]+e[1]*e[1];e>d&&(d=e,k=r)}k=[d,k];d=k[0];k=k[1];m&&m({bez:f,points:c,params:h,maxErr:d,maxPoint:k});
return[f,d,k]}function B(c,h,b){return b.map(function(b,k){var d=h[k],f=a.subtract(x.q(c,b),d),n=x.qprime(c,b),d=a.mulMatrix(f,n),f=a.sum(a.addItems(a.squareItems(n),a.mulMatrix(f,x.qprimeprime(c,b))));return 0===f?b:b-d/f})}function A(c){var h=[],b,d,k;c.forEach(function(c,f){b=f?d+a.vectorLen(a.subtract(c,k)):0;h.push(b);d=b;k=c});return h=h.map(function(b){return b/d})}var a=function(){function a(){v(this,a)}a.zeros_Xx2x2=function(a){for(var b=[];a--;)b.push([0,0]);return b};a.mulItems=function(a,
b){return[a[0]*b,a[1]*b]};a.mulMatrix=function(a,b){return a[0]*b[0]+a[1]*b[1]};a.subtract=function(a,b){return[a[0]-b[0],a[1]-b[1]]};a.addArrays=function(a,b){return[a[0]+b[0],a[1]+b[1]]};a.addItems=function(a,b){return[a[0]+b,a[1]+b]};a.sum=function(a){return a.reduce(function(a,h){return a+h})};a.dot=function(h,b){return a.mulMatrix(h,b)};a.vectorLen=function(a){var b=a[0];a=a[1];return Math.sqrt(b*b+a*a)};a.divItems=function(a,b){return[a[0]/b,a[1]/b]};a.squareItems=function(a){var b=a[0];a=a[1];
return[b*b,a*a]};a.normalize=function(a){return this.divItems(a,this.vectorLen(a))};return a}(),x=function(){function c(){v(this,c)}c.q=function(c,b){var d=1-b,h=a.mulItems(c[0],d*d*d),m=a.mulItems(c[1],3*d*d*b),d=a.mulItems(c[2],3*d*b*b),f=a.mulItems(c[3],b*b*b);return a.addArrays(a.addArrays(h,m),a.addArrays(d,f))};c.qprime=function(c,b){var d=1-b,h=a.mulItems(a.subtract(c[1],c[0]),3*d*d),d=a.mulItems(a.subtract(c[2],c[1]),6*d*b),m=a.mulItems(a.subtract(c[3],c[2]),3*b*b);return a.addArrays(a.addArrays(h,
d),m)};c.qprimeprime=function(c,b){return a.addArrays(a.mulItems(a.addArrays(a.subtract(c[2],a.mulItems(c[1],2)),c[0]),6*(1-b)),a.mulItems(a.addArrays(a.subtract(c[3],a.mulItems(c[2],2)),c[1]),6*b))};return c}(),C=function(c,h){for(var b,d=[0],k=c[0],m=0,f=1;f<=h;f++)b=x.q(c,f/h),m+=a.vectorLen(a.subtract(b,k)),d.push(m),k=b;return d=d.map(function(a){return a/m})};y.exports=function(c,h,b){var d=c.length,k=a.normalize(a.subtract(c[1],c[0])),d=a.normalize(a.subtract(c[d-2],c[d-1]));return w(c,k,d,
h,b)}});
